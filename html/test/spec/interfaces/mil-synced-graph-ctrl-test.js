/*
 *  Licensed Materials - Property of IBM
 *  Â© Copyright IBM Corporation 2014. All Rights Reserved.
 *  This sample program is provided AS IS and may be used, executed, copied and modified without royalty 
 *  payment by customer (a) for its own instruction and study, (b) in order to develop applications designed to 
 *  run with an IBM product, either for customer's own internal use or for redistribution by customer, as part 
 *  of such an application, in customer's own products.
 */

describe("milSyncedGraphCtrl", function() {

    /*
     *  Setup
     */
    
    // Mock ReadyAppHC
    beforeEach(module('ReadyAppHC'));

    // Retrieve providers
    var $scope, $location, $route, $rootScope, $translate, $controller, $httpBackend;

    beforeEach(inject(function(_$location_, _$route_, _$rootScope_, _$translate_, _$controller_, _$httpBackend_) {
        $scope = _$rootScope_;
        $location = _$location_;
        $route = _$route_;
        $rootScope = _$rootScope_;
        $translate = _$translate_;
        $controller = _$controller_;
        $httpBackend = _$httpBackend_;
    }));
    
    var milCtrl;
    
    // Create milCtrl
    beforeEach(inject(function() {
        milCtrl = $controller('milCtrl', {
            $scope: $scope,
            $location: $location,
            $route: $route,
            $translate: $translate,
            $rootScope: $rootScope
        });
    }));
    
    var milTabbedGraphCtrl;
    
    // Create milTabbedGraphCtrl
    beforeEach(inject(function(_choreographerService_) {
        dashboardCtrl = $controller('milTabbedGraphCtrl', {
            $scope: $scope,
            $controller: $controller,
            choreographerService: _choreographerService_,
            selectedTab: 48
        });
    }));
    
    var milSyncedGraphCtrl;
    
    // Create milTabbedGraphCtrl
    beforeEach(inject(function() {
        dashboardCtrl = $controller('milSyncedGraphCtrl', {
            $scope: $scope,
            $controller: $controller,
            selectedTab: 48
        });
        
        $scope.baseRoute = "/WebView/metrics";
        $scope.switchRoute("/WebView/metrics");
    }));
    
    /*
     *  Specs
     */
    
    it("should have correct initial property values", function() {
        expect($scope.transformData.xGraph).toBe(0);
        expect($scope.iter).toBe(0);
    });
    
    it("should apply data correctly", function() {
        var dat = [
            '[{"x":"1","y":89},{"x":"2","y":90},{"x":"3","y":92},{"x":"4","y":89},{"x":"5","y":89},{"x":"6","y":84},{"x":"7","y":100},{"x":"8","y":92},{"x":"9","y":90},{"x":"10","y":91},{"x":"11","y":88},{"x":"12","y":99},{"x":"13","y":90},{"x":"14","y":87},{"x":"15","y":87},{"x":"16","y":88},{"x":"17","y":89},{"x":"18","y":96},{"x":"19","y":94}, {"x":"20","y":93}, {"x":"21","y":90}, {"x":"22","y":101}, {"x":"23","y":91}, {"x":"24","y":90}, {"x":"25","y":90}, {"x":"26","y":88}, {"x":"27","y":87}, {"x":"28","y":87}, {"x":"29","y":92}, {"x":"30","y":90}, {"x":"31","y":95},{"x":"32","y":94},{"x":"33","y":93},{"x":"34","y":92},{"x":"35","y":92},{"x":"36","y":90},{"x":"37","y":100},{"x":"38","y":89},{"x":"39","y":89},{"x":"40","y":90},{"x":"41","y":88},{"x":"42","y":99},{"x":"43","y":90},{"x":"44","y":87},{"x":"45","y":87},{"x":"46","y":88},{"x":"47","y":93},{"x":"48","y":90}]',
                '[{"x":"1","y":150},{"x":"2","y":150},{"x":"3","y":150},{"x":"4","y":150},{"x":"5","y":149},{"x":"6","y":149},{"x":"7","y":148},{"x":"8","y":149},{"x":"9","y":148},{"x":"10","y":148},{"x":"11","y":148},{"x":"12","y":147},{"x":"13","y":147},{"x":"14","y":146},{"x":"15","y":146},{"x":"16","y":146},{"x":"17","y":146},{"x":"18","y":145},{"x":"19","y":145}, {"x":"20","y":145}, {"x":"21","y":147}, {"x":"22","y":147}, {"x":"23","y":146}, {"x":"24","y":145}, {"x":"25","y":145}, {"x":"26","y":145}, {"x":"27","y":144}, {"x":"28","y":144}, {"x":"29","y":144}, {"x":"30","y":144}, {"x":"31","y":144},{"x":"32","y":144},{"x":"33","y":143},{"x":"34","y":143},{"x":"35","y":144},{"x":"36","y":143},{"x":"37","y":143},{"x":"38","y":142},{"x":"39","y":142},{"x":"40","y":142},{"x":"41","y":142},{"x":"42","y":142},{"x":"43","y":141},{"x":"44","y":141},{"x":"45","y":141},{"x":"46","y":141},{"x":"47","y":140},{"x":"48","y":140}]',
            '[{"x":"1","y":890},{"x":"2","y":784},{"x":"3","y":901},{"x":"4","y":1245},{"x":"5","y":900},{"x":"6","y":929},{"x":"7","y":456},{"x":"8","y":198},{"x":"9","y":345},{"x":"10","y":515},{"x":"11","y":677},{"x":"12","y":1050},{"x":"13","y":1401},{"x":"14","y":989},{"x":"15","y":899},{"x":"16","y":813},{"x":"17","y":784},{"x":"18","y":790},{"x":"19","y":832}, {"x":"20","y":900}, {"x":"21","y":945}, {"x":"22","y":940}, {"x":"23","y":1077}, {"x":"24","y":999}, {"x":"25","y":621}, {"x":"26","y":198}, {"x":"27","y":367}, {"x":"28","y":1006}, {"x":"29","y":1021}, {"x":"30","y":866}, {"x":"31","y":696},{"x":"32","y":599},{"x":"33","y":752},{"x":"34","y":342},{"x":"35","y":500},{"x":"36","y":788},{"x":"37","y":913},{"x":"38","y":877},{"x":"39","y":787},{"x":"40","y":767},{"x":"41","y":600},{"x":"42","y":1327},{"x":"43","y":1099},{"x":"44","y":909},{"x":"45","y":303},{"x":"46","y":278},{"x":"47","y":612},{"x":"48","y":561}]',
            '[{"x":"1","y":300},{"x":"2","y":109},{"x":"3","y":99},{"x":"4","y":245},{"x":"5","y":255},{"x":"6","y":278},{"x":"7","y":164},{"x":"8","y":401},{"x":"9","y":378},{"x":"10","y":309},{"x":"11","y":260},{"x":"12","y":222},{"x":"13","y":198},{"x":"14","y":134},{"x":"15","y":232},{"x":"16","y":88},{"x":"17","y":299},{"x":"18","y":203},{"x":"19","y":132}, {"x":"20","y":99}, {"x":"21","y":264}, {"x":"22","y":199}, {"x":"23","y":389}, {"x":"24","y":299}, {"x":"25","y":304}, {"x":"26","y":213}, {"x":"27","y":345}, {"x":"28","y":109}, {"x":"29","y":200}, {"x":"30","y":455}, {"x":"31","y":333},{"x":"32","y":342},{"x":"33","y":290},{"x":"34","y":250},{"x":"35","y":252},{"x":"36","y":177},{"x":"37","y":266},{"x":"38","y":99},{"x":"39","y":278},{"x":"40","y":301},{"x":"41","y":392},{"x":"42","y":213},{"x":"43","y":78},{"x":"44","y":145},{"x":"45","y":205},{"x":"46","y":245},{"x":"47","y":266},{"x":"48","y":303}]',
            '[{"x":"1","y":3},{"x":"2","y":4},{"x":"3","y":3},{"x":"4","y":3},{"x":"5","y":3},{"x":"6","y":2},{"x":"7","y":3},{"x":"8","y":3},{"x":"9","y":4},{"x":"10","y":4},{"x":"11","y":4},{"x":"12","y":3},{"x":"13","y":10},{"x":"14","y":9},{"x":"15","y":9},{"x":"16","y":8},{"x":"17","y":8},{"x":"18","y":4},{"x":"19","y":4}, {"x":"20","y":3}, {"x":"21","y":3}, {"x":"22","y":2}, {"x":"23","y":2}, {"x":"24","y":2}, {"x":"25","y":2}, {"x":"26","y":2}, {"x":"27","y":2}, {"x":"28","y":1}, {"x":"29","y":1}, {"x":"30","y":1}, {"x":"31","y":1},{"x":"32","y":5},{"x":"33","y":5},{"x":"34","y":4},{"x":"35","y":4},{"x":"36","y":4},{"x":"37","y":4},{"x":"38","y":2},{"x":"39","y":2},{"x":"40","y":1},{"x":"41","y":1},{"x":"42","y":1},{"x":"43","y":1},{"x":"44","y":1},{"x":"45","y":1},{"x":"46","y":2},{"x":"47","y":3},{"x":"48","y":2}]'
        ];
        
        $httpBackend.expectGET("views/metrics.html");
        $httpBackend.whenGET("views/metrics.html").respond({ hello: "world" });
        var listener = jasmine.createSpy("listener");
        $rootScope.$on("invalidate_graph", listener);
        $scope.applyData(dat);
        
        expect($scope.data).toBe(dat);
        expect(listener).toHaveBeenCalled();
    });
    
    it("should be able to provide the right data at the right time", function() {
        var dat = [
            '[{"x":"1","y":89},{"x":"2","y":90},{"x":"3","y":92},{"x":"4","y":89},{"x":"5","y":89},{"x":"6","y":84},{"x":"7","y":100},{"x":"8","y":92},{"x":"9","y":90},{"x":"10","y":91},{"x":"11","y":88},{"x":"12","y":99},{"x":"13","y":90},{"x":"14","y":87},{"x":"15","y":87},{"x":"16","y":88},{"x":"17","y":89},{"x":"18","y":96},{"x":"19","y":94}, {"x":"20","y":93}, {"x":"21","y":90}, {"x":"22","y":101}, {"x":"23","y":91}, {"x":"24","y":90}, {"x":"25","y":90}, {"x":"26","y":88}, {"x":"27","y":87}, {"x":"28","y":87}, {"x":"29","y":92}, {"x":"30","y":90}, {"x":"31","y":95},{"x":"32","y":94},{"x":"33","y":93},{"x":"34","y":92},{"x":"35","y":92},{"x":"36","y":90},{"x":"37","y":100},{"x":"38","y":89},{"x":"39","y":89},{"x":"40","y":90},{"x":"41","y":88},{"x":"42","y":99},{"x":"43","y":90},{"x":"44","y":87},{"x":"45","y":87},{"x":"46","y":88},{"x":"47","y":93},{"x":"48","y":90}]',
                '[{"x":"1","y":150},{"x":"2","y":150},{"x":"3","y":150},{"x":"4","y":150},{"x":"5","y":149},{"x":"6","y":149},{"x":"7","y":148},{"x":"8","y":149},{"x":"9","y":148},{"x":"10","y":148},{"x":"11","y":148},{"x":"12","y":147},{"x":"13","y":147},{"x":"14","y":146},{"x":"15","y":146},{"x":"16","y":146},{"x":"17","y":146},{"x":"18","y":145},{"x":"19","y":145}, {"x":"20","y":145}, {"x":"21","y":147}, {"x":"22","y":147}, {"x":"23","y":146}, {"x":"24","y":145}, {"x":"25","y":145}, {"x":"26","y":145}, {"x":"27","y":144}, {"x":"28","y":144}, {"x":"29","y":144}, {"x":"30","y":144}, {"x":"31","y":144},{"x":"32","y":144},{"x":"33","y":143},{"x":"34","y":143},{"x":"35","y":144},{"x":"36","y":143},{"x":"37","y":143},{"x":"38","y":142},{"x":"39","y":142},{"x":"40","y":142},{"x":"41","y":142},{"x":"42","y":142},{"x":"43","y":141},{"x":"44","y":141},{"x":"45","y":141},{"x":"46","y":141},{"x":"47","y":140},{"x":"48","y":140}]',
            '[{"x":"1","y":890},{"x":"2","y":784},{"x":"3","y":901},{"x":"4","y":1245},{"x":"5","y":900},{"x":"6","y":929},{"x":"7","y":456},{"x":"8","y":198},{"x":"9","y":345},{"x":"10","y":515},{"x":"11","y":677},{"x":"12","y":1050},{"x":"13","y":1401},{"x":"14","y":989},{"x":"15","y":899},{"x":"16","y":813},{"x":"17","y":784},{"x":"18","y":790},{"x":"19","y":832}, {"x":"20","y":900}, {"x":"21","y":945}, {"x":"22","y":940}, {"x":"23","y":1077}, {"x":"24","y":999}, {"x":"25","y":621}, {"x":"26","y":198}, {"x":"27","y":367}, {"x":"28","y":1006}, {"x":"29","y":1021}, {"x":"30","y":866}, {"x":"31","y":696},{"x":"32","y":599},{"x":"33","y":752},{"x":"34","y":342},{"x":"35","y":500},{"x":"36","y":788},{"x":"37","y":913},{"x":"38","y":877},{"x":"39","y":787},{"x":"40","y":767},{"x":"41","y":600},{"x":"42","y":1327},{"x":"43","y":1099},{"x":"44","y":909},{"x":"45","y":303},{"x":"46","y":278},{"x":"47","y":612},{"x":"48","y":561}]',
            '[{"x":"1","y":300},{"x":"2","y":109},{"x":"3","y":99},{"x":"4","y":245},{"x":"5","y":255},{"x":"6","y":278},{"x":"7","y":164},{"x":"8","y":401},{"x":"9","y":378},{"x":"10","y":309},{"x":"11","y":260},{"x":"12","y":222},{"x":"13","y":198},{"x":"14","y":134},{"x":"15","y":232},{"x":"16","y":88},{"x":"17","y":299},{"x":"18","y":203},{"x":"19","y":132}, {"x":"20","y":99}, {"x":"21","y":264}, {"x":"22","y":199}, {"x":"23","y":389}, {"x":"24","y":299}, {"x":"25","y":304}, {"x":"26","y":213}, {"x":"27","y":345}, {"x":"28","y":109}, {"x":"29","y":200}, {"x":"30","y":455}, {"x":"31","y":333},{"x":"32","y":342},{"x":"33","y":290},{"x":"34","y":250},{"x":"35","y":252},{"x":"36","y":177},{"x":"37","y":266},{"x":"38","y":99},{"x":"39","y":278},{"x":"40","y":301},{"x":"41","y":392},{"x":"42","y":213},{"x":"43","y":78},{"x":"44","y":145},{"x":"45","y":205},{"x":"46","y":245},{"x":"47","y":266},{"x":"48","y":303}]',
            '[{"x":"1","y":3},{"x":"2","y":4},{"x":"3","y":3},{"x":"4","y":3},{"x":"5","y":3},{"x":"6","y":2},{"x":"7","y":3},{"x":"8","y":3},{"x":"9","y":4},{"x":"10","y":4},{"x":"11","y":4},{"x":"12","y":3},{"x":"13","y":10},{"x":"14","y":9},{"x":"15","y":9},{"x":"16","y":8},{"x":"17","y":8},{"x":"18","y":4},{"x":"19","y":4}, {"x":"20","y":3}, {"x":"21","y":3}, {"x":"22","y":2}, {"x":"23","y":2}, {"x":"24","y":2}, {"x":"25","y":2}, {"x":"26","y":2}, {"x":"27","y":2}, {"x":"28","y":1}, {"x":"29","y":1}, {"x":"30","y":1}, {"x":"31","y":1},{"x":"32","y":5},{"x":"33","y":5},{"x":"34","y":4},{"x":"35","y":4},{"x":"36","y":4},{"x":"37","y":4},{"x":"38","y":2},{"x":"39","y":2},{"x":"40","y":1},{"x":"41","y":1},{"x":"42","y":1},{"x":"43","y":1},{"x":"44","y":1},{"x":"45","y":1},{"x":"46","y":2},{"x":"47","y":3},{"x":"48","y":2}]'
        ];
        
        $httpBackend.expectGET("views/metrics.html");
        $httpBackend.whenGET("views/metrics.html").respond({ hello: "world" });
        $scope.applyData(dat);
        
        var yummy = $scope.nom();
        expect(yummy).toBe(dat[0]);
        expect($scope.iter).toBe(1);
        
        yummy = $scope.nom();
        expect(yummy).toBe((dat[1]));
        expect($scope.iter).toBe(2);
        
        $scope.nom();
        $scope.nom();
        yummy = $scope.nom();
        expect(yummy).toBe((dat[4]));
        expect($scope.iter).toBe(0);
    });
    
    // Done Testing

});