package com.ibm.mil;

import io.selendroid.SelendroidCapabilities;
import io.selendroid.SelendroidConfiguration;
import io.selendroid.SelendroidDriver;
import io.selendroid.SelendroidLauncher;

import org.junit.After;
import org.junit.AfterClass;
import org.junit.Assert;
import org.junit.Before;
import org.junit.BeforeClass;
import org.junit.Test;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;

// TODO: The android hybrid test (this one) is currently 
// broken due to an incompatibility issue with Selendroid and the 
// latest version of Cordova. There is an issue opened on the 
// Selendroid github: https://github.com/selendroid/selendroid/issues/658

public class DashboardTest {
	private static SelendroidLauncher selendroidServer = null;
	private static WebDriver driver = null;

	private static SelendroidLauncher selendroidServer = null;
	private static WebDriver driver = null;

	@BeforeClass
	public static void startSelendroidServer() throws Exception {
		selendroidServer = AndroidUtilities.androidTestSetupSelendroid(selendroidServer);
	}
	
	@Before
	public void setupSelendriod() throws Exception {
		driver = AndroidUtilities.androidTestSetupWebDriver(driver);
	}

	@After
	public void refreshSelendroidDriver() {
		AndroidUtilities.androidTestTeardownDriver(driver);
	}
	@AfterClass
	public static void stopSelendroidServer() {
		AndroidUtilities.androidTestTeardownServer(selendroidServer);
	}
	// TODO: This test currently tests that the web elements exist on the page.
	// As the
	// application is fleshed out more, this test should become more robust IE
	// testing that the 'Get Started' button is clickable and takes the user to
	// the correct screen

	@Test
	public void test1() {
		WebElement user = driver.findElement(By.id("patient_id"));
		WebElement password = driver.findElement(By.id("password"));

		user.sendKeys("user1");
		password.sendKeys("password1");

		// Select the login button
		WebElement loginButton = driver.findElement(By.id("login_button"));
		loginButton.click();

		// Wait for next page to load
		try {
			Thread.sleep(4000);
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		// Select the webview
		WebElement web = driver.findElement(By.id("web_view"));
		web.click();

		// now that a webview is displayed, switch to web mode.
		driver.switchTo().window("WEBVIEW");

		// Check that the date field exists
		WebElement date = driver.findElement(By.id("c"));
		Assert.assertNotNull("Date Field exists", date);

		// Check that the minutes field exists
		WebElement minutes = driver.findElement(By.id("f"));
		Assert.assertNotNull("Minutes Field exists", minutes);

		// Check that the minutes label field exists
		WebElement minutesLabel = driver.findElement(By.id("g"));
		Assert.assertNotNull("Minutes Label field exists", minutesLabel);

		// Check that the exercises field exists
		WebElement exercises = driver.findElement(By.id("i"));
		Assert.assertNotNull("Exercises Field exists", exercises);

		// Check that the exercises label field exists
		WebElement exercisesLabel = driver.findElement(By.id("j"));
		Assert.assertNotNull("Exercises Label field exists", exercisesLabel);

		// Check that the sessions field exists
		WebElement sessions = driver.findElement(By.id("l"));
		Assert.assertNotNull("Sessions Field exists", sessions);

		// Check that the sessions label field exists
		WebElement sessionsLabel = driver.findElement(By.id("m"));
		Assert.assertNotNull("Sessions Label field exists", sessionsLabel);

		// TODO: Check that the Get Started button exists  As the app grows, we
		// will want to check that this is clickable.
		WebElement getStarted = driver.findElement(By.id("n"));
		Assert.assertNotNull("Get Started field exists", getStarted);

	}

}